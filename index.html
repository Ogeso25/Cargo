<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Festival Ticket</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <h1>Festival Ticket</h1>
  <p>Bitte gib deinen Zugangscode ein, um den Ticket-Link zu sehen:</p>

  <!-- Eingabefeld für den Code -->
  <input type="password" id="accessCode" class="input-field" placeholder="Geheimer Zugangscode">
  <button id="validateButton" class="button-5" disabled>Code überprüfen</button>

  <!-- Der Button zum Kaufen, standardmäßig versteckt -->
  <div id="ticketButton" class="hidden">
    <button id="stripeButton" class="button-5">Festival Ticket</button>
  </div>

  <script>
    const CSV_URL = "https://ogeso25.github.io/Cargo/codes.csv";

    const accessCodeInput = document.getElementById('accessCode');
    const validateButton = document.getElementById('validateButton');
    const ticketButton = document.getElementById('ticketButton');
    const stripeButton = document.getElementById('stripeButton');

    let validCodes = [];
    let codeVerified = false;

    async function loadCodes() {
      try {
        const response = await fetch(CSV_URL);
        const csvText = await response.text();
        const rows = csvText.split("\n").map(row => row.trim());
        validCodes = rows.slice(1).filter(row => row !== ""); // Entferne Leerzeichen/Leerzeilen
        console.log("Gültige Codes geladen:", validCodes); // Debugging
      } catch (error) {
        console.error("Fehler beim Laden der CSV-Datei:", error);
        alert("Fehler beim Laden der Codes. Bitte versuchen Sie es später erneut.");
      }
    }

    function validateCode() {
      const userCode = accessCodeInput.value.trim(); // Entferne Leerzeichen
      const lowerCaseCodes = validCodes.map(code => code.toLowerCase());
      if (lowerCaseCodes.includes(userCode.toLowerCase())) {
        codeVerified = true;
        ticketButton.classList.remove('hidden');
        alert('Code korrekt! Der Ticket-Button ist jetzt sichtbar.');
      } else {
        codeVerified = false;
        alert('Falscher Code. Bitte versuche es erneut.');
      }
    }

    stripeButton.addEventListener('click', function (e) {
      if (!codeVerified) {
        e.preventDefault();
        alert('Bitte überprüfe zuerst deinen Zugangscode.');
      } else {
        window.open('https://buy.stripe.com/9AQdUR4g96LybVS7sw', '_blank');
      }
    });

    loadCodes().then(() => {
      validateButton.disabled = false; // Button aktivieren
    });

    validateButton.addEventListener('click', validateCode);
  </script>
</body>
</html>
