<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Festival Ticket</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <h1>Festival Ticket</h1>
  <p>Bitte gib deinen Zugangscode ein, um den Ticket-Link zu sehen:</p>

  <!-- Eingabefeld für den Code -->
  <input type="password" id="accessCode" class="input-field" placeholder="Geheimer Zugangscode">
  <button id="validateButton" class="button-5">Code überprüfen</button>

  <!-- Der Button zum Kaufen, standardmäßig versteckt -->
  <div id="ticketButton" class="hidden">
    <button id="stripeButton" class="button-5">Festival Ticket</button>
  </div>

  <script>
    // URL der CSV-Datei
    const CSV_URL = "https://ogeso25.github.io/Cargo/codes.csv";

    // Variablen
    const accessCodeInput = document.getElementById('accessCode');
    const validateButton = document.getElementById('validateButton');
    const ticketButton = document.getElementById('ticketButton');
    const stripeButton = document.getElementById('stripeButton');

    // Variable, um die Liste gültiger Codes zu speichern
    let validCodes = [];
    let codeVerified = false;

    // Funktion: CSV-Datei laden
    async function loadCodes() {
      try {
        const response = await fetch(CSV_URL);
        const csvText = await response.text();
        const rows = csvText.split("\n").map(row => row.trim());
        validCodes = rows.slice(1); // Erste Zeile (Header) überspringen
      } catch (error) {
        console.error("Fehler beim Laden der CSV-Datei:", error);
      }
    }

    // Funktion: Zugangscode prüfen
    function validateCode() {
      const userCode = accessCodeInput.value;

      if (validCodes.includes(userCode)) {
        codeVerified = true;
        ticketButton.classList.remove('hidden'); // Ticket-Button anzeigen
        alert('Code korrekt! Der Ticket-Button ist jetzt sichtbar.');
      } else {
        codeVerified = false;
        alert('Falscher Code. Bitte versuche es erneut.');
      }
    }

    // Event-Listener für den "Code überprüfen"-Button
    validateButton.addEventListener('click', validateCode);

    // Event-Listener für den Stripe-Button
    stripeButton.addEventListener('click', function (e) {
      if (!codeVerified) {
        e.preventDefault(); // Verhindert Weiterleitung
        alert('Bitte überprüfe zuerst deinen Zugangscode.');
      } else {
        window.open('https://buy.stripe.com/9AQdUR4g96LybVS7sw', '_blank');
      }
    });

    // Lade die Codes beim Start der Seite
    loadCodes();
  </script>
</body>
</html>
